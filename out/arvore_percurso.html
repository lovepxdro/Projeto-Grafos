<html>
    <head>
        <meta charset="utf-8">
        
            <script>function neighbourhoodHighlight(params) {
  // console.log("in nieghbourhoodhighlight");
  allNodes = nodes.get({ returnType: "Object" });
  // originalNodes = JSON.parse(JSON.stringify(allNodes));
  // if something is selected:
  if (params.nodes.length > 0) {
    highlightActive = true;
    var i, j;
    var selectedNode = params.nodes[0];
    var degrees = 2;

    // mark all nodes as hard to read.
    for (let nodeId in allNodes) {
      // nodeColors[nodeId] = allNodes[nodeId].color;
      allNodes[nodeId].color = "rgba(200,200,200,0.5)";
      if (allNodes[nodeId].hiddenLabel === undefined) {
        allNodes[nodeId].hiddenLabel = allNodes[nodeId].label;
        allNodes[nodeId].label = undefined;
      }
    }
    var connectedNodes = network.getConnectedNodes(selectedNode);
    var allConnectedNodes = [];

    // get the second degree nodes
    for (i = 1; i < degrees; i++) {
      for (j = 0; j < connectedNodes.length; j++) {
        allConnectedNodes = allConnectedNodes.concat(
          network.getConnectedNodes(connectedNodes[j])
        );
      }
    }

    // all second degree nodes get a different color and their label back
    for (i = 0; i < allConnectedNodes.length; i++) {
      // allNodes[allConnectedNodes[i]].color = "pink";
      allNodes[allConnectedNodes[i]].color = "rgba(150,150,150,0.75)";
      if (allNodes[allConnectedNodes[i]].hiddenLabel !== undefined) {
        allNodes[allConnectedNodes[i]].label =
          allNodes[allConnectedNodes[i]].hiddenLabel;
        allNodes[allConnectedNodes[i]].hiddenLabel = undefined;
      }
    }

    // all first degree nodes get their own color and their label back
    for (i = 0; i < connectedNodes.length; i++) {
      // allNodes[connectedNodes[i]].color = undefined;
      allNodes[connectedNodes[i]].color = nodeColors[connectedNodes[i]];
      if (allNodes[connectedNodes[i]].hiddenLabel !== undefined) {
        allNodes[connectedNodes[i]].label =
          allNodes[connectedNodes[i]].hiddenLabel;
        allNodes[connectedNodes[i]].hiddenLabel = undefined;
      }
    }

    // the main node gets its own color and its label back.
    // allNodes[selectedNode].color = undefined;
    allNodes[selectedNode].color = nodeColors[selectedNode];
    if (allNodes[selectedNode].hiddenLabel !== undefined) {
      allNodes[selectedNode].label = allNodes[selectedNode].hiddenLabel;
      allNodes[selectedNode].hiddenLabel = undefined;
    }
  } else if (highlightActive === true) {
    // console.log("highlightActive was true");
    // reset all nodes
    for (let nodeId in allNodes) {
      // allNodes[nodeId].color = "purple";
      allNodes[nodeId].color = nodeColors[nodeId];
      // delete allNodes[nodeId].color;
      if (allNodes[nodeId].hiddenLabel !== undefined) {
        allNodes[nodeId].label = allNodes[nodeId].hiddenLabel;
        allNodes[nodeId].hiddenLabel = undefined;
      }
    }
    highlightActive = false;
  }

  // transform the object into an array
  var updateArray = [];
  if (params.nodes.length > 0) {
    for (let nodeId in allNodes) {
      if (allNodes.hasOwnProperty(nodeId)) {
        // console.log(allNodes[nodeId]);
        updateArray.push(allNodes[nodeId]);
      }
    }
    nodes.update(updateArray);
  } else {
    // console.log("Nothing was selected");
    for (let nodeId in allNodes) {
      if (allNodes.hasOwnProperty(nodeId)) {
        // console.log(allNodes[nodeId]);
        // allNodes[nodeId].color = {};
        updateArray.push(allNodes[nodeId]);
      }
    }
    nodes.update(updateArray);
  }
}

function filterHighlight(params) {
  allNodes = nodes.get({ returnType: "Object" });
  // if something is selected:
  if (params.nodes.length > 0) {
    filterActive = true;
    let selectedNodes = params.nodes;

    // hiding all nodes and saving the label
    for (let nodeId in allNodes) {
      allNodes[nodeId].hidden = true;
      if (allNodes[nodeId].savedLabel === undefined) {
        allNodes[nodeId].savedLabel = allNodes[nodeId].label;
        allNodes[nodeId].label = undefined;
      }
    }

    for (let i=0; i < selectedNodes.length; i++) {
      allNodes[selectedNodes[i]].hidden = false;
      if (allNodes[selectedNodes[i]].savedLabel !== undefined) {
        allNodes[selectedNodes[i]].label = allNodes[selectedNodes[i]].savedLabel;
        allNodes[selectedNodes[i]].savedLabel = undefined;
      }
    }

  } else if (filterActive === true) {
    // reset all nodes
    for (let nodeId in allNodes) {
      allNodes[nodeId].hidden = false;
      if (allNodes[nodeId].savedLabel !== undefined) {
        allNodes[nodeId].label = allNodes[nodeId].savedLabel;
        allNodes[nodeId].savedLabel = undefined;
      }
    }
    filterActive = false;
  }

  // transform the object into an array
  var updateArray = [];
  if (params.nodes.length > 0) {
    for (let nodeId in allNodes) {
      if (allNodes.hasOwnProperty(nodeId)) {
        updateArray.push(allNodes[nodeId]);
      }
    }
    nodes.update(updateArray);
  } else {
    for (let nodeId in allNodes) {
      if (allNodes.hasOwnProperty(nodeId)) {
        updateArray.push(allNodes[nodeId]);
      }
    }
    nodes.update(updateArray);
  }
}

function selectNode(nodes) {
  network.selectNodes(nodes);
  neighbourhoodHighlight({ nodes: nodes });
  return nodes;
}

function selectNodes(nodes) {
  network.selectNodes(nodes);
  filterHighlight({nodes: nodes});
  return nodes;
}

function highlightFilter(filter) {
  let selectedNodes = []
  let selectedProp = filter['property']
  if (filter['item'] === 'node') {
    let allNodes = nodes.get({ returnType: "Object" });
    for (let nodeId in allNodes) {
      if (allNodes[nodeId][selectedProp] && filter['value'].includes((allNodes[nodeId][selectedProp]).toString())) {
        selectedNodes.push(nodeId)
      }
    }
  }
  else if (filter['item'] === 'edge'){
    let allEdges = edges.get({returnType: 'object'});
    // check if the selected property exists for selected edge and select the nodes connected to the edge
    for (let edge in allEdges) {
      if (allEdges[edge][selectedProp] && filter['value'].includes((allEdges[edge][selectedProp]).toString())) {
        selectedNodes.push(allEdges[edge]['from'])
        selectedNodes.push(allEdges[edge]['to'])
      }
    }
  }
  selectNodes(selectedNodes)
}</script>
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.2/dist/dist/vis-network.min.css" integrity="sha512-WgxfT5LWjfszlPHXRmBWHkV2eceiWTOBvrKCNbdgDYTHrT2AeLCGbF4sZlZw3UMN3WtL0tGUoIAKsu8mllg/XA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
            <script src="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.2/dist/vis-network.min.js" integrity="sha512-LnvoEWDFrqGHlHmDD2101OrLcbsfkrzoSpvtSQtxK3RMnRV0eOkhhBN2dXHKRrUU8p2DGRTk35n4O8nWSVe1mQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
            
            
            
            
            
            

        

<!-- <link rel="stylesheet" href="../node_modules/vis/dist/vis.min.css" type="text/css" />
<script type="text/javascript" src="../node_modules/vis/dist/vis.js"> </script>-->
        <link
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6"
          crossorigin="anonymous"
        />
        <script
          src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
          crossorigin="anonymous"
        ></script>
        <style type="text/css">

             #mynetwork {
                 width: 100%;
                 height: 700px;
                 background-color: #ffffff;
                 border: 1px solid #e9ecef;
                 border-radius: .5rem;
                 position: relative;
                 float: left;
             }

             

             

             
        </style>
    </head>


    <body>
        <!-- Simple header bar -->
        <div class="container py-3">
          <div class="d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between gap-2">
            <h3 class="m-0">Árvore de Percurso</h3>
            <div class="d-flex gap-2">
              <button id="fitBtn" class="btn btn-sm btn-outline-secondary">Ajustar à tela</button>
              <button id="physicsBtn" class="btn btn-sm btn-secondary">Física: on</button>
            </div>
          </div>
        </div>

        <div class="container pb-4">
          <div class="card shadow-sm border-0">
            <div class="card-body p-2 p-md-3">
              <div id="mynetwork"></div>
            </div>
          </div>
        </div>

        
        

        <script type="text/javascript">

              // initialize global variables.
              var edges;
              var nodes;
              var allNodes;
              var allEdges;
              var nodeColors;
              var originalNodes;
              var network;
              var container;
              var options, data;
              var filter = {
                  item : '',
                  property : '',
                  value : []
              };

        // minimal flags used by highlight/filter helpers
        var highlightActive = false;
        var filterActive = false;

              

              

              // This method is responsible for drawing the graph, returns the drawn network
              function drawGraph() {
                  var container = document.getElementById('mynetwork');

                  

                  // parsing and collecting nodes and edges from the python
                  nodes = new vis.DataSet([{"color": "#97c2fc", "id": "Nova Descoberta", "label": "Nova Descoberta", "shape": "dot", "title": "Bairro: Nova Descoberta\u003cbr\u003eMicrorregi\u00e3o: 3.3"}, {"color": "#97c2fc", "id": "Casa Amarela", "label": "Casa Amarela", "shape": "dot", "title": "Bairro: Casa Amarela\u003cbr\u003eMicrorregi\u00e3o: 3.1"}, {"color": "#97c2fc", "id": "Tamarineira", "label": "Tamarineira", "shape": "dot", "title": "Bairro: Tamarineira\u003cbr\u003eMicrorregi\u00e3o: 3.1"}, {"color": "#97c2fc", "id": "Gra\u00e7as", "label": "Gra\u00e7as", "shape": "dot", "title": "Bairro: Gra\u00e7as\u003cbr\u003eMicrorregi\u00e3o: 3.1"}, {"color": "#97c2fc", "id": "Derby", "label": "Derby", "shape": "dot", "title": "Bairro: Derby\u003cbr\u003eMicrorregi\u00e3o: 3.1"}, {"color": "#97c2fc", "id": "Ilha do Retiro", "label": "Ilha do Retiro", "shape": "dot", "title": "Bairro: Ilha do Retiro\u003cbr\u003eMicrorregi\u00e3o: 4.1"}, {"color": "#97c2fc", "id": "Afogados", "label": "Afogados", "shape": "dot", "title": "Bairro: Afogados\u003cbr\u003eMicrorregi\u00e3o: 5.1"}, {"color": "#97c2fc", "id": "Imbiribeira", "label": "Imbiribeira", "shape": "dot", "title": "Bairro: Imbiribeira\u003cbr\u003eMicrorregi\u00e3o: 6.1"}, {"color": "#97c2fc", "id": "Boa Viagem", "label": "Boa Viagem", "shape": "dot", "title": "Bairro: Boa Viagem\u003cbr\u003eMicrorregi\u00e3o: 6.1"}]);
                  edges = new vis.DataSet([{"arrows": "to", "color": "#FF5733", "from": "Nova Descoberta", "title": "Nova Descoberta -\u003e Casa Amarela\u003cbr\u003eCusto: 1.0\u003cbr\u003eLogradouro: r. paraisopolis", "to": "Casa Amarela", "value": 1.0, "width": 4}, {"arrows": "to", "color": "#FF5733", "from": "Casa Amarela", "title": "Casa Amarela -\u003e Tamarineira\u003cbr\u003eCusto: 2.0\u003cbr\u003eLogradouro: e. do arraial", "to": "Tamarineira", "value": 2.0, "width": 4}, {"arrows": "to", "color": "#FF5733", "from": "Tamarineira", "title": "Tamarineira -\u003e Gra\u00e7as\u003cbr\u003eCusto: 1.2\u003cbr\u003eLogradouro: r. coronel uriel sergio cardim", "to": "Gra\u00e7as", "value": 1.2, "width": 4}, {"arrows": "to", "color": "#FF5733", "from": "Gra\u00e7as", "title": "Gra\u00e7as -\u003e Derby\u003cbr\u003eCusto: 1.0\u003cbr\u003eLogradouro: r. joaquim nabuco", "to": "Derby", "value": 1.0, "width": 4}, {"arrows": "to", "color": "#FF5733", "from": "Derby", "title": "Derby -\u003e Ilha do Retiro\u003cbr\u003eCusto: 2.0\u003cbr\u003eLogradouro: p. prefeito lima e castro", "to": "Ilha do Retiro", "value": 2.0, "width": 4}, {"arrows": "to", "color": "#FF5733", "from": "Ilha do Retiro", "title": "Ilha do Retiro -\u003e Afogados\u003cbr\u003eCusto: 1.2\u003cbr\u003eLogradouro: r. teofilo tworz", "to": "Afogados", "value": 1.2, "width": 4}, {"arrows": "to", "color": "#FF5733", "from": "Afogados", "title": "Afogados -\u003e Imbiribeira\u003cbr\u003eCusto: 1.0\u003cbr\u003eLogradouro: r. arquiteto luiz nunes", "to": "Imbiribeira", "value": 1.0, "width": 4}, {"arrows": "to", "color": "#FF5733", "from": "Imbiribeira", "title": "Imbiribeira -\u003e Boa Viagem\u003cbr\u003eCusto: 2.2\u003cbr\u003eLogradouro: av. dom joao vi", "to": "Boa Viagem", "value": 2.2, "width": 4}]);

                  nodeColors = {};
                  allNodes = nodes.get({ returnType: "Object" });
                  for (nodeId in allNodes) {
                    nodeColors[nodeId] = allNodes[nodeId].color;
                  }
                  allEdges = edges.get({ returnType: "Object" });
                  // adding nodes and edges to the graph
                  data = {nodes: nodes, edges: edges};

          var options = {
    "configure": {
        "enabled": false
    },
    "edges": {
    "arrows": {
      "to": { "enabled": true, "type": "arrow", "scaleFactor": 1.2 }
    },
    "arrowStrikethrough": false,
    "color": {
      "inherit": false,
      "color": "#ff6b35",
      "highlight": "#ff3b30",
      "hover": "#ff8a5b",
      "opacity": 0.9
    },
        "smooth": {
      "enabled": true,
      "type": "dynamic",
      "roundness": 0.3
    },
    "shadow": { "enabled": true, "color": "rgba(0,0,0,0.15)", "size": 6, "x": 0, "y": 2 },
    "width": 3,
    "selectionWidth": 2,
    "hoverWidth": 1.5
    },
    "interaction": {
    "dragNodes": true,
    "hideEdgesOnDrag": false,
    "hideNodesOnDrag": false,
    "hover": true,
    "hoverConnectedEdges": true
    },
    "physics": {
        "enabled": true,
        "stabilization": {
            "enabled": true,
            "fit": true,
            "iterations": 1000,
            "onlyDynamicEdges": false,
            "updateInterval": 50
        }
    }
};

                  


                  

                  network = new vis.Network(container, data, options);

                  // Harmonize edge colors to match nicer arrow palette
                  try {
                    edges.get().forEach(function(e){
                      if (e && e.id !== undefined) {
                        edges.update({
                          id: e.id,
                          color: { color: '#ff6b35', highlight: '#ff3b30', hover: '#ff8a5b', opacity: 0.9 }
                        });
                      }
                    });
                  } catch (err) { /* no-op */ }

                  // Controls: simple and minimal
                  var fitBtn = document.getElementById('fitBtn');
                  if (fitBtn) {
                    fitBtn.addEventListener('click', function(){
                      network.fit({ animation: { duration: 500, easing: 'easeInOutQuad' } });
                    });
                  }
                  var physicsBtn = document.getElementById('physicsBtn');
                  var physicsState = true;
                  if (physicsBtn) {
                    physicsBtn.addEventListener('click', function(){
                      physicsState = !physicsState;
                      network.setOptions({ physics: { enabled: physicsState } });
                      physicsBtn.textContent = 'Física: ' + (physicsState ? 'on' : 'off');
                    });
                  }

                  

                  

                  


                  

                  return network;

              }
              drawGraph();
        </script>
    </body>
</html>